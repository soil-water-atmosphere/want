---
title: "Lorenz Strange Attractor"
author: "Chiel van Heerwaarden"
date: "1/15/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plotly)
```

## Lorenz

$$
\begin{align}
\dfrac{\mathrm{d}x}{\mathrm{d}t} &= \sigma (y - x), \\
\dfrac{\mathrm{d}y}{\mathrm{d}t} &= x (\rho - z) - y, \\
\dfrac{\mathrm{d}z}{\mathrm{d}t} &= x y - \beta z.
\end{align}
$$

```{r parameters}
rho = 5. #28.
sigma = 10. # 10.
beta = 8./3. # 8./3.

total_time = 100. # 100.
```

```{r initial_values}
x = 1.
y = 1.
z = 1.

t_ef = c()
x_ef = c()
y_ef = c()
z_ef = c()

t_ef[1] = 0.
x_ef[1] = x
y_ef[1] = y
z_ef[1] = z

t_rk = c()
x_rk = c()
y_rk = c()
z_rk = c()

t_rk[1] = 0.
x_rk[1] = x
y_rk[1] = y
z_rk[1] = z
```

```{r rhs}
calc_rhs = function(x, y, z)
{
  dxdt = sigma*(y-x)
  dydt = x*(rho-z) - y
  dzdt = x*y - beta*z
  return(c(dxdt, dydt, dzdt))
}
```

```{r euler_forward}
dt = 0.01

nt = total_time / dt
t = 0.

for (n in 1:nt)
{
  dsdt = calc_rhs(x,y,z)
  x = x + dt * dsdt[1]
  y = y + dt * dsdt[2]
  z = z + dt * dsdt[3]
  
  t = t + dt
  
  t_ef[n+1] = t
  x_ef[n+1] = x
  y_ef[n+1] = y
  z_ef[n+1] = z
}
```

```{r rk4}
dt = 0.01

nt = total_time / dt
t = 0.

for (n in 1:nt)
{
  k1 = dt * calc_rhs(x           , y           , z           )
  k2 = dt * calc_rhs(x + k1[1]/2., y + k1[2]/2., z + k1[3]/2.)
  k3 = dt * calc_rhs(x + k2[1]/2., y + k2[2]/2., z + k2[3]/2.)
  k4 = dt * calc_rhs(x + k3[1]   , y + k3[2]   , z + k3[3]   )
  
  xyz = c(x, y, z) + (k1 + 2.*k2 + 2.*k3 + k4)/6.
  
  x = xyz[1]
  y = xyz[2]
  z = xyz[3]
  
  t = t + dt
  
  t_rk[n+1] = t
  x_rk[n+1] = x
  y_rk[n+1] = y
  z_rk[n+1] = z
}
```

```{r}
p = plot_ly()
p = add_trace(p, x=t_ef, y=y_ef, name="ef", mode="lines")
p = add_trace(p, x=t_rk, y=y_rk, name="rk", mode="lines")
p
# plot_ly(x=t_ef, y=y_ef, name="y", mode="lines")
# plot_ly(x=t_ef, y=z_ef, name="z", mode="lines")
```
```{r}
p = plot_ly()
p = add_trace(p, x=x_ef, y=y_ef, z=z_ef, mode="lines")
p = add_trace(p, x=x_rk, y=y_rk, z=z_rk, mode="lines")
p
```
